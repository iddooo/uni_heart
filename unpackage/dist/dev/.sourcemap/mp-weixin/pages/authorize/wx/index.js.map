{"version":3,"sources":["uni-app:///main.js","webpack:///C:/Users/dell/Desktop/uni_heart/pages/Authorize/wx/index.vue?5faf","webpack:///C:/Users/dell/Desktop/uni_heart/pages/Authorize/wx/index.vue?0230","webpack:///C:/Users/dell/Desktop/uni_heart/pages/Authorize/wx/index.vue?9d3d","webpack:///C:/Users/dell/Desktop/uni_heart/pages/Authorize/wx/index.vue?eee5","uni-app:///pages/Authorize/wx/index.vue","webpack:///C:/Users/dell/Desktop/uni_heart/pages/Authorize/wx/index.vue?f31c","webpack:///C:/Users/dell/Desktop/uni_heart/pages/Authorize/wx/index.vue?ecee"],"names":["createPage","Page"],"mappings":";;;;;;;;;;kDAAA;AACA;AACA,mG;AACAA,UAAU,CAACC,cAAD,CAAV,C;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAkH;AAClH;AACyD;AACL;AACa;;;AAGjE;AACqK;AACrK,gBAAgB,+KAAU;AAC1B,EAAE,2EAAM;AACR,EAAE,gFAAM;AACR,EAAE,yFAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,oFAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACRA;AAAA;AAAA;AAAA;AAA+lB,CAAgB,ynBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;ACennB,kE;;;;;;;;;;;;;;eAEA,EACA,IADA,kBACA,CACA,SACA,aADA,EAEA;AACA,+BAHA,GAKA,CAPA,EAQA,MARA,kBAQA,OARA,EAQA,CACA;AACA,4BACA,4CACA,2BACA,oBACA;AACA,GAfA;AAgBA;AACA,eADA,uBACA,CADA,EACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,OANA,MAMA;AACA;AACA;AACA;AACA,KAbA;AAcA,SAdA,mBAcA;AACA;AACA;AACA;AACA;AACA,oBADA;;AAGA;AACA;AACA;AACA;AACA;AACA,sBADA;AAEA,gCAFA;AAGA,wDAHA,EAGA;AACA,8CAJA,CAIA;AAJA,aAKA,IALA,CAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,2BADA;AAEA,mDAFA;;AAIA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,4BADA;AAEA,4BAFA;;AAIA,WAnCA;AAoCA,SAxCA;;AA0CA,KA/DA;AAgEA,kBAhEA,0BAgEA,CAhEA,EAgEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBADA;AAEA,yBAFA;AAGA,+CAHA;AAIA,2CAJA;;AAMA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,2BADA;AAEA,6BAFA;AAGA,4BAHA;AAIA,qBAJA,qBAIA;AACA;AACA,eANA;;AAQA;AACA,SAhBA;AAiBA,OA1BA,MA0BA;AACA;AACA;AACA;;AAEA,KAnGA;AAoGA,aApGA,uBAoGA;AACA;AACA;AACA;AACA,KAxGA;AAyGA,UAzGA,oBAyGA;AACA;AACA,wCADA;;AAGA,KA7GA;AA8GA,YA9GA,oBA8GA,QA9GA,EA8GA;AACA;AACA;AACA,8BADA;AAEA,uCAFA;AAGA,0BAHA;AAIA,gCAJA;AAKA,2CALA;;AAOA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,SAFA,MAEA;AACA;AACA;AACA;AACA,OAbA;AAcA,KArIA,EAhBA,E;;;;;;;;;;;;;ACjBA;AAAA;AAAA;AAAA;AAAi3B,CAAgB,k3BAAG,EAAC,C;;;;;;;;;;;ACAr4B;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/Authorize/wx/index.js","sourcesContent":["import 'uni-pages';\nimport Vue from 'vue'\nimport Page from './pages/Authorize/wx/index.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./index.vue?vue&type=template&id=20489ee3&\"\nvar renderjs\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/Authorize/wx/index.vue\"\nexport default component.exports","export * from \"-!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--16-0!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./index.vue?vue&type=template&id=20489ee3&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./index.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view class=\"page\">\r\n\t\t<image class=\"logo\" src=\"/pages/Authorize/images/wx.png\" mode=\"widthFix\" />\r\n\t\t<view class=\"title\">微信授权页面</view>\r\n\t\t<view class=\"profile\">{{tip}}</view>\r\n\t\r\n\t\t<!-- 授权登录按钮 -->\r\n\t\t<button v-if=\"stepStatus === 1\" type=\"primary\" open-type=\"getUserInfo\" @getuserinfo=\"getUserInfo\" class=\"weui-btn mini-btn\">授权登录</button>\r\n\t\r\n\t\t<!-- 授权手机号按钮 -->\r\n\t\t<button v-if=\"stepStatus === 2\" type=\"primary\" open-type=\"getPhoneNumber\" @getphonenumber=\"getPhoneNumber\" class=\"weui-btn mini-btn\">获取手机号码</button>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport { postCode, getTokenData, bindMobile } from '../../../api/login.js'\r\n\t\r\n\texport default {\r\n\t\tdata(){\r\n\t\t\treturn {\r\n\t\t\t\tstepStatus:1,\r\n\t\t\t\t// 授权提示信息\r\n\t\t\t\ttip: '授权并同意使用微信账号登录当前小程序',\r\n\t\t\t}\r\n\t\t},\r\n\t\tonLoad(options) {\r\n\t\t\t// console.log(mapActions)\r\n\t\t\tlet step = options.step\r\n\t\t\tlet isLogin = uni.getStorageSync('isLogin')\r\n\t\t\tif(step==2 && isLogin){\r\n\t\t\t\tthis.stepStatus = 2\r\n\t\t\t}\r\n\t\t},\r\n\t\tmethods:{\r\n\t\t\tgetUserInfo(e){\r\n\t\t\t\tlet detail = e.detail\r\n\t\t\t\tif(detail.errMsg == 'getUserInfo:ok'){\r\n\t\t\t\t\tconsole.log('获取用户信息ok======')\r\n\t\t\t\t\tuni.setStorageSync('userDetail',detail)\r\n\t\t\t\t\t\r\n\t\t\t\t\tconsole.log('开始注册登录')\r\n\t\t\t\t\tthis.login()\r\n\t\t\t\t}else{\r\n\t\t\t\t\tconsole.log('拒绝获取用户信息')\r\n\t\t\t\t\tthis.LoginFail()\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tlogin(){\r\n\t\t\t\tlet _this = this\r\n\t\t\t\tlet invitedId = uni.getStorageSync('invitedId')\r\n\t\t\t\tlet userDetail = uni.getStorageSync('userDetail')\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\t title: '登陆中',\r\n\t\t\t\t})\r\n\t\t\t\tuni.login({\r\n\t\t\t\t  success: function (loginRes) {\r\n\t\t\t\t    // console.log(loginRes);\r\n\t\t\t\t\tlet code = loginRes.code\r\n\t\t\t\t\tpostCode({\r\n\t\t\t\t\t\tcode:code,\r\n\t\t\t\t\t\tinvitedId:invitedId,\r\n\t\t\t\t\t\tsex:userDetail.userInfo.gender==2?0:1,//1男 0女\r\n\t\t\t\t\t\tname:userDetail.userInfo.nickName,//微信昵称\r\n\t\t\t\t\t}).then(res=>{\r\n\t\t\t\t\t\t// 测试数据\r\n\t\t\t\t\t\tlet userInfo = {\"id\":\"306\",\"sno\":\"1000\",\"openid\":null,\"sessionKey\":null,\"phoneType\":true,\"forzen\":0,\"bankType\":null,\"bankCard\":null,\"faceUrl\":null,\"birthday\":null,\"sex\":0,\"groupId\":10,\"phone\":\"18583027254\",\"userName\":\"1000\",\"cusPassword\":\"0b0bb750e5fbec975c9ebaf9f64bd76b\",\"headPic\":null,\"iOpenid\":null,\"aOpenid\":null,\"appleId\":null,\"nickname\":\"D儿\"}\r\n\t\t\t\t\t\t// if(res.code==1){\r\n\t\t\t\t\t\t\tconsole.log('注册登录成功')\r\n\t\t\t\t\t\t\t// let userInfo = res.data\r\n\t\t\t\t\t\t\tuni.setStorageSync('userInfo',userInfo)\r\n\t\t\t\t\t\t\tuni.setStorageSync('userId',userInfo.id)\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\tif(userInfo.forzen==1){\r\n\t\t\t\t\t\t\t\tconsole.log('您的账号被冻结了')\r\n\t\t\t\t\t\t\t\twx.hideLoading()\r\n\t\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\t\ttitle: '提示',\r\n\t\t\t\t\t\t\t\t\tcontent: '账号已冻结，请联系客服:400-970-0989',\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t_this.LoginFail()\r\n\t\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tconsole.log('获取用户token')\r\n\t\t\t\t\t\t\t_this.getToken(userInfo)\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\treturn\r\n\t\t\t\t\t\t// }\r\n\t\t\t\t\t\tconsole.log('注册登录失败')\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t    title: '登录失败了',\r\n\t\t\t\t\t\t    duration: 2000\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t})\r\n\t\t\t\t  }\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tgetPhoneNumber(e){\r\n\t\t\t\t// console.log(e)\r\n\t\t\t\tlet _this = this\r\n\t\t\t\tlet msg = e.detail.errMsg\r\n\t\t\t\tif(msg == 'getPhoneNumber:ok'){\r\n\t\t\t\t\tlet id = uni.getStorageSync('userId')\r\n\t\t\t\t\tlet userDetail = uni.getStorageSync('userDetail')\r\n\t\t\t\t\tlet data = {\r\n\t\t\t\t\t\tid:id,\r\n\t\t\t\t\t\tiv:e.detail.iv,\r\n\t\t\t\t\t\tencryptedData:e.detail.encryptedData,\r\n\t\t\t\t\t\tsessionKey:userDetail.sessionKey\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbindMobile(data).then(res=>{\r\n\t\t\t\t\t\tif(res.code==1){\r\n\t\t\t\t\t\t\tconsole.log('绑定手机号码成功')\r\n\t\t\t\t\t\t\tlet userInfo = uni.getStorageSync('userInfo')\r\n\t\t\t\t\t\t\tuserInfo.phoneType = true\r\n\t\t\t\t\t\t\tuni.setStorageSync('userInfo',userInfo)\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\twx.showToast({\r\n\t\t\t\t\t\t\t\ttitle: '绑定成功',\r\n\t\t\t\t\t\t\t\ticon: 'success',\r\n\t\t\t\t\t\t\t\tduration: 1000,\r\n\t\t\t\t\t\t\t\tsuccess() {\r\n\t\t\t\t\t\t\t\t  _this.goHome()\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t}else{\r\n\t\t\t\t\tconsole.log('拒绝获取手机号码')\r\n\t\t\t\t\tthis.goHome()\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t},\r\n\t\t\tLoginFail(){\r\n\t\t\t\tuni.removeStorageSync('token')\r\n\t\t\t\tuni.removeStorageSync('isLogin')\r\n\t\t\t\tthis.goHome()\r\n\t\t\t},\r\n\t\t\tgoHome(){\r\n\t\t\t\tuni.switchTab({\r\n\t\t\t\t    url: '/pages/Tabbar/index/index'\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tgetToken(userInfo){\r\n\t\t\t\tlet _this = this\r\n\t\t\t\tlet form = {\r\n\t\t\t\t  grant_type: 'password',\r\n\t\t\t\t  username: userInfo.sno + '-shu',\r\n\t\t\t\t  password: '123456',\r\n\t\t\t\t  client_id: 'smart-heart',\r\n\t\t\t\t  client_secret: 'smart-heart-secret'\r\n\t\t\t\t}\r\n\t\t\t\tgetTokenData(form).then(res=>{\r\n\t\t\t\t\tconsole.log('获取token登录成功======',res.access_token)\r\n\t\t\t\t\tuni.setStorageSync('token',res.access_token)\r\n\t\t\t\t\tuni.setStorageSync('isLogin',true)\r\n\t\t\t\t\twx.hideLoading()\r\n\t\t\t\t\t\r\n\t\t\t\t\tconsole.log('是否已经获取用户电话号码',userInfo.phoneType)\r\n\t\t\t\t\tif(userInfo.phoneType){\r\n\t\t\t\t\t\t_this.goHome()\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tthis.stepStatus = 2\r\n\t\t\t\t\t\tthis.tip = '授权并同意获取你的电话号码'\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\t.logo {\r\n\t  width:200rpx;\r\n\t  margin-top:180rpx;\r\n\t  margin-left:275rpx;\r\n\t}\r\n\t.title {\r\n\t  text-align: center;\r\n\t  margin-top:70rpx;\r\n\t}\r\n\t.profile {\r\n\t  text-align: center;\r\n\t  margin-top:30rpx;\r\n\t  font-size: 14px;\r\n\t  color:#888;\r\n\t}\r\n\t.mini-btn{\r\n\t  margin-top: 50rpx;\r\n\t  margin-left: 50px;\r\n\t  margin-right: 50px;\r\n\t}\r\n\t\r\n</style>\r\n","import mod from \"-!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--6-oneOf-1-0!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--6-oneOf-1-1!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--6-oneOf-1-2!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--6-oneOf-1-3!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./index.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--6-oneOf-1-0!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--6-oneOf-1-1!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--6-oneOf-1-2!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--6-oneOf-1-3!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./index.vue?vue&type=style&index=0&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1606720309834\n      var cssReload = require(\"D:/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}